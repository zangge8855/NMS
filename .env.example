# ============================
# Node Management System (NMS) 配置
# ============================
# 复制此文件为 .env 并修改以下配置

# ---------- 核心安全 ----------
# JWT 密钥 (生产环境必须修改, 至少 32 位随机字符串)
JWT_SECRET=change-this-to-a-random-secret-key-in-production

# 管理员用户名 (建议使用非 admin 的自定义用户名)
# ADMIN_USERNAME=cluster-admin

# 节点凭据加密密钥 (生产环境必须单独设置, 不要与 JWT_SECRET 相同)
# CREDENTIALS_SECRET=change-this-to-a-dedicated-random-secret-key

# 历史加密密钥列表 (用于密钥轮换后的兼容解密, 逗号分隔)
# CREDENTIALS_LEGACY_SECRETS=

# 管理员密码 (生产环境必须修改: 至少 8 位，且包含大写/小写/数字/特殊字符中的 3 类)
ADMIN_PASSWORD=change-this-to-a-strong-password

# JWT Token 过期时间
JWT_EXPIRES_IN=24h

# WebSocket Ticket 有效期(秒)
# WS_TICKET_TTL_SECONDS=600

# 是否允许旧版"仅密码"登录 (默认 true)
# ALLOW_LEGACY_PASSWORD_LOGIN=true

# 是否强制安全检查 (生产环境自动开启; 开发环境可手动开启)
# ENFORCE_STRICT_SECURITY=false

# ---------- 服务器 ----------
# 服务端口
PORT=3001

# 运行环境: development | production
NODE_ENV=production

# 数据目录 (默认: ../data)
# DATA_DIR=./data

# ---------- 数据库 (PostgreSQL, 可选) ----------
# 是否开启数据库存储层
# DB_ENABLED=false

# PostgreSQL 连接串
# DB_URL=postgres://postgres:postgres@127.0.0.1:5432/nms_dev

# Schema 名称
# DB_SCHEMA=nms_dev

# 连接池最大连接数
# DB_POOL_MAX=10

# SSL 模式: disable | require
# DB_SSL_MODE=disable

# 启动时自动建表/初始化
# DB_MIGRATION_AUTO=true

# 存储读取模式: file | db
# STORE_READ_MODE=file

# 存储写入模式: file | dual | db
# STORE_WRITE_MODE=file

# DB 回填默认是否脱敏(开发环境建议 true)
# DB_BACKFILL_REDACT=true

# DB 回填默认是否 dry-run(开发环境建议 true)
# DB_BACKFILL_DRY_RUN=true

# 数据库隐私模式: standard | strict
# DB_PRIVACY_MODE=strict

# 是否允许添加内网地址的面板 (默认关闭)
# ALLOW_PRIVATE_SERVER_URL=false

# ---------- 订阅系统 ----------
# 订阅 Token 默认有效天数
# SUB_TOKEN_DEFAULT_TTL_DAYS=30

# 订阅 Token 最大有效天数
# SUB_TOKEN_MAX_TTL_DAYS=365

# 每个用户最大活跃 Token 数量
# SUB_TOKEN_MAX_ACTIVE=5

# 可选: 订阅对外访问基址 (建议公网部署时设置, 避免链接出现 localhost/内网地址)
# 例如: https://nms.example.com
# SUB_PUBLIC_BASE_URL=

# 可选: 订阅转换器地址 (用于生成 Clash/sing-box 订阅)
# 例如: http://127.0.0.1:25500/sub 或 https://your-subconverter.example/sub
# SUB_CONVERTER_BASE_URL=

# 可选: Clash 转换模板/规则地址 (subconverter 的 config 参数)
# SUB_CONVERTER_CLASH_CONFIG_URL=

# 可选: sing-box 转换模板/规则地址 (subconverter 的 config 参数)
# SUB_CONVERTER_SINGBOX_CONFIG_URL=
# 说明: 未配置 SUB_CONVERTER_BASE_URL 时, 前端不会提供 Clash/sing-box 专用链接

# ---------- 审计日志 ----------
# 审计日志保留天数
# AUDIT_RETENTION_DAYS=365

# 审计日志分页最大条数
# AUDIT_MAX_PAGE_SIZE=200

# 订阅访问日志 IP 归属地解析 (默认关闭; 开启后会请求外部服务, 可能涉及隐私)
# AUDIT_IP_GEO_ENABLED=false
# AUDIT_IP_GEO_PROVIDER=ipip_myip
# AUDIT_IP_GEO_ENDPOINT=http://myip.ipip.net
# AUDIT_IP_GEO_TIMEOUT_MS=1500
# AUDIT_IP_GEO_CACHE_TTL_SECONDS=21600

# ---------- 流量统计 ----------
# 流量数据保留天数
# TRAFFIC_RETENTION_DAYS=365

# 流量采样间隔 (秒)
# TRAFFIC_SAMPLE_INTERVAL_SECONDS=300

# 流量采集并发数
# TRAFFIC_COLLECTOR_CONCURRENCY=3

# ---------- 批量任务 ----------
# 批量任务记录保留天数
# JOB_RETENTION_DAYS=90

# 批量任务分页最大条数
# JOB_MAX_PAGE_SIZE=200

# 批量任务最大记录数
# JOB_MAX_RECORDS=2000

# 批量操作最大并发数
# JOB_MAX_CONCURRENCY=10

# ---------- 邮箱验证 (SMTP) ----------
# SMTP 服务器地址 (如 smtp.gmail.com, smtp.qq.com)
SMTP_HOST=
# SMTP 端口 (一般 587 或 465)
SMTP_PORT=587
# SMTP 是否使用 SSL (端口 465 时设为 true)
# SMTP_SECURE=false
# SMTP 登录用户名
SMTP_USER=
# SMTP 登录密码 / 应用密码
SMTP_PASS=
# 发件人地址 (默认等于 SMTP_USER)
# SMTP_FROM=

# ---------- 用户注册 ----------
# 是否开启用户自助注册 (默认 true)
# REGISTRATION_ENABLED=true
# 自注册用户默认角色 (user)
# REGISTRATION_DEFAULT_ROLE=user
# 验证码有效时间 (分钟)
# VERIFY_CODE_TTL_MINUTES=15
# 找回密码验证码有效时间 (分钟)
# PASSWORD_RESET_CODE_TTL_MINUTES=15

